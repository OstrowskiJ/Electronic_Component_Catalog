<!DOCTYPE html>

<html>
<head>
<meta charset="UTF-8">

<title>marker.coffee - RDoc Documentation</title>

<script type="text/javascript">
  var rdoc_rel_prefix = "../../../../../../";
  var index_rel_prefix = "../../../../../../";
</script>

<script src="../../../../../../js/jquery.js"></script>
<script src="../../../../../../js/darkfish.js"></script>

<link href="../../../../../../css/fonts.css" rel="stylesheet">
<link href="../../../../../../css/rdoc.css" rel="stylesheet">



<body id="top" role="document" class="file">
<nav role="navigation">
  <div id="project-navigation">
    <div id="home-section" role="region" title="Quick navigation" class="nav-section">
  <h2>
    <a href="../../../../../../index.html" rel="home">Home</a>
  </h2>

  <div id="table-of-contents-navigation">
    <a href="../../../../../../table_of_contents.html#pages">Pages</a>
    <a href="../../../../../../table_of_contents.html#classes">Classes</a>
    <a href="../../../../../../table_of_contents.html#methods">Methods</a>
  </div>
</div>

    <div id="search-section" role="search" class="project-section initially-hidden">
  <form action="#" method="get" accept-charset="utf-8">
    <div id="search-field-wrapper">
      <input id="search-field" role="combobox" aria-label="Search"
             aria-autocomplete="list" aria-controls="search-results"
             type="text" name="search" placeholder="Search" spellcheck="false"
             title="Type to search, Up and Down to navigate, Enter to load">
    </div>

    <ul id="search-results" aria-label="Search Results"
        aria-busy="false" aria-expanded="false"
        aria-atomic="false" class="initially-hidden"></ul>
  </form>
</div>

  </div>

  

  <div id="project-metadata">
    <div id="fileindex-section" class="nav-section">
  <h3>Pages</h3>

  <ul class="link-list">
  
    <li><a href="../../../../../../Gemfile.html">Gemfile</a>
  
    <li><a href="../../../../../../Gemfile_lock.html">Gemfile.lock</a>
  
    <li><a href="../../../../../../README_md.html">README</a>
  
    <li><a href="../../../../../../Rakefile.html">Rakefile</a>
  
    <li><a href="../../../../../../app/assets/config/manifest_js.html">manifest.js</a>
  
    <li><a href="../../../../../../app/assets/javascripts/application_js.html">application.js</a>
  
    <li><a href="../../../../../../app/assets/javascripts/cable_js.html">cable.js</a>
  
    <li><a href="../../../../../../app/assets/javascripts/catalogs_coffee.html">catalogs.coffee</a>
  
    <li><a href="../../../../../../app/assets/javascripts/channels/room_coffee.html">room.coffee</a>
  
    <li><a href="../../../../../../app/assets/javascripts/chat_js.html">chat.js</a>
  
    <li><a href="../../../../../../app/assets/javascripts/conversations_coffee.html">conversations.coffee</a>
  
    <li><a href="../../../../../../app/assets/javascripts/gmaps/base_coffee.html">base.coffee</a>
  
    <li><a href="../../../../../../app/assets/javascripts/gmaps/base/base_coffee.html">base.coffee</a>
  
    <li><a href="../../../../../../app/assets/javascripts/gmaps/google_coffee.html">google.coffee</a>
  
    <li><a href="../../../../../../app/assets/javascripts/gmaps/google/builders/bound_coffee.html">bound.coffee</a>
  
    <li><a href="../../../../../../app/assets/javascripts/gmaps/google/builders/circle_coffee.html">circle.coffee</a>
  
    <li><a href="../../../../../../app/assets/javascripts/gmaps/google/builders/clusterer_coffee.html">clusterer.coffee</a>
  
    <li><a href="../../../../../../app/assets/javascripts/gmaps/google/builders/kml_coffee.html">kml.coffee</a>
  
    <li><a href="../../../../../../app/assets/javascripts/gmaps/google/builders/map_coffee.html">map.coffee</a>
  
    <li><a href="../../../../../../app/assets/javascripts/gmaps/google/builders/marker_coffee.html">marker.coffee</a>
  
    <li><a href="../../../../../../app/assets/javascripts/gmaps/google/builders/polygon_coffee.html">polygon.coffee</a>
  
    <li><a href="../../../../../../app/assets/javascripts/gmaps/google/builders/polyline_coffee.html">polyline.coffee</a>
  
    <li><a href="../../../../../../app/assets/javascripts/gmaps/google/objects/bound_coffee.html">bound.coffee</a>
  
    <li><a href="../../../../../../app/assets/javascripts/gmaps/google/objects/circle_coffee.html">circle.coffee</a>
  
    <li><a href="../../../../../../app/assets/javascripts/gmaps/google/objects/clusterer_coffee.html">clusterer.coffee</a>
  
    <li><a href="../../../../../../app/assets/javascripts/gmaps/google/objects/common_coffee.html">common.coffee</a>
  
    <li><a href="../../../../../../app/assets/javascripts/gmaps/google/objects/kml_coffee.html">kml.coffee</a>
  
    <li><a href="../../../../../../app/assets/javascripts/gmaps/google/objects/map_coffee.html">map.coffee</a>
  
    <li><a href="../../../../../../app/assets/javascripts/gmaps/google/objects/marker_coffee.html">marker.coffee</a>
  
    <li><a href="../../../../../../app/assets/javascripts/gmaps/google/objects/polygon_coffee.html">polygon.coffee</a>
  
    <li><a href="../../../../../../app/assets/javascripts/gmaps/google/objects/polyline_coffee.html">polyline.coffee</a>
  
    <li><a href="../../../../../../app/assets/javascripts/gmaps/google/primitives_coffee.html">primitives.coffee</a>
  
    <li><a href="../../../../../../app/assets/javascripts/gmaps/objects/base_builder_coffee.html">base_builder.coffee</a>
  
    <li><a href="../../../../../../app/assets/javascripts/gmaps/objects/builder_coffee.html">builder.coffee</a>
  
    <li><a href="../../../../../../app/assets/javascripts/gmaps/objects/handler_coffee.html">handler.coffee</a>
  
    <li><a href="../../../../../../app/assets/javascripts/gmaps/objects/null_clusterer_coffee.html">null_clusterer.coffee</a>
  
    <li><a href="../../../../../../app/assets/javascripts/home_coffee.html">home.coffee</a>
  
    <li><a href="../../../../../../app/assets/javascripts/locations_coffee.html">locations.coffee</a>
  
    <li><a href="../../../../../../app/assets/javascripts/messages_coffee.html">messages.coffee</a>
  
    <li><a href="../../../../../../app/assets/javascripts/posts_coffee.html">posts.coffee</a>
  
    <li><a href="../../../../../../app/assets/javascripts/rooms_coffee.html">rooms.coffee</a>
  
    <li><a href="../../../../../../app/assets/javascripts/searches_coffee.html">searches.coffee</a>
  
    <li><a href="../../../../../../app/assets/javascripts/users_js.html">users.js</a>
  
    <li><a href="../../../../../../app/assets/stylesheets/application_css_scss.html">application.css.scss</a>
  
    <li><a href="../../../../../../app/assets/stylesheets/catalogs_scss.html">catalogs.scss</a>
  
    <li><a href="../../../../../../app/assets/stylesheets/chat_css.html">chat.css</a>
  
    <li><a href="../../../../../../app/assets/stylesheets/conversations_scss.html">conversations.scss</a>
  
    <li><a href="../../../../../../app/assets/stylesheets/custom_css_scss.html">custom.css.scss</a>
  
    <li><a href="../../../../../../app/assets/stylesheets/home_scss.html">home.scss</a>
  
    <li><a href="../../../../../../app/assets/stylesheets/locations_scss.html">locations.scss</a>
  
    <li><a href="../../../../../../app/assets/stylesheets/messages_scss.html">messages.scss</a>
  
    <li><a href="../../../../../../app/assets/stylesheets/posts_scss.html">posts.scss</a>
  
    <li><a href="../../../../../../app/assets/stylesheets/rooms_scss.html">rooms.scss</a>
  
    <li><a href="../../../../../../app/assets/stylesheets/scaffolds_scss.html">scaffolds.scss</a>
  
    <li><a href="../../../../../../app/assets/stylesheets/searches_scss.html">searches.scss</a>
  
    <li><a href="../../../../../../app/assets/stylesheets/users_scss.html">users.scss</a>
  
    <li><a href="../../../../../../app/views/locations/_location_json_jbuilder.html">_location.json.jbuilder</a>
  
    <li><a href="../../../../../../app/views/locations/index_json_jbuilder.html">index.json.jbuilder</a>
  
    <li><a href="../../../../../../app/views/locations/show_json_jbuilder.html">show.json.jbuilder</a>
  
    <li><a href="../../../../../../app/views/posts/_post_json_jbuilder.html">_post.json.jbuilder</a>
  
    <li><a href="../../../../../../app/views/posts/index_json_jbuilder.html">index.json.jbuilder</a>
  
    <li><a href="../../../../../../app/views/posts/show_json_jbuilder.html">show.json.jbuilder</a>
  
    <li><a href="../../../../../../app/views/users/_location_json_jbuilder.html">_location.json.jbuilder</a>
  
    <li><a href="../../../../../../app/views/users/show_json_jbuilder.html">show.json.jbuilder</a>
  
    <li><a href="../../../../../../config_ru.html">config.ru</a>
  
    <li><a href="../../../../../../db/test_sqlite3.html">test.sqlite3</a>
  
    <li><a href="../../../../../../log/development_log.html">development.log</a>
  
    <li><a href="../../../../../../log/production_log.html">production.log</a>
  
    <li><a href="../../../../../../log/test_log.html">test.log</a>
  
    <li><a href="../../../../../../private_pub_ru.html">private_pub.ru</a>
  
    <li><a href="../../../../../../public/404_html.html">404.html</a>
  
    <li><a href="../../../../../../public/422_html.html">422.html</a>
  
    <li><a href="../../../../../../public/500_html.html">500.html</a>
  
    <li><a href="../../../../../../public/apple-touch-icon-precomposed_png.html">apple-touch-icon-precomposed.png</a>
  
    <li><a href="../../../../../../public/apple-touch-icon_png.html">apple-touch-icon.png</a>
  
    <li><a href="../../../../../../public/favicon_ico.html">favicon.ico</a>
  
    <li><a href="../../../../../../public/javascripts/gmaps_google_js.html">gmaps_google.js</a>
  
    <li><a href="../../../../../../public/robots_txt.html">robots</a>
  
    <li><a href="../../../../../../tmp/restart_txt.html">restart</a>
  
    <li><a href="../../../../../../vendor/assets/javascripts/underscore_js.html">underscore.js</a>
  
  </ul>
</div>

  </div>
</nav>

<main role="main" aria-label="Page app/assets/javascripts/gmaps/google/builders/marker.coffee">

<p>class @Gmaps.Google.Builders.Marker extends Gmaps.Objects.BaseBuilder</p>

<pre>@CURRENT_INFOWINDOW: undefined
@CACHE_STORE: {}

# args:
#   lat
#   lng
#   infowindow
#   marker_title
#   picture
#     anchor: [x,y]
#     url
#     width
#     height
#   shadow
#     anchor: [x,y]
#     url
#     width
#     height
# provider options:
#   https://developers.google.com/maps/documentation/javascript/reference?hl=fr#MarkerOptions
# internal_options
#   singleInfowindow: true/false
#   maxRandomDistance: null / int in meters
constructor: (@args, @provider_options = {}, @internal_options = {})-&gt;
  @before_init()
  @create_marker()
  @create_infowindow_on_click()
  @after_init()

build: -&gt;
  @marker = new(@model_class())(@serviceObject)

create_marker: -&gt;
  @serviceObject = new(@primitives().marker)(@marker_options())

create_infowindow: -&gt;
  return null unless _.isString @args.infowindow
  new(@primitives().infowindow)({content: @args.infowindow })

marker_options: -&gt;
  coords = @_randomized_coordinates()
  base_options =
    title:    @args.marker_title
    position: new(@primitives().latLng)(coords[0], coords[1])
    icon:     @_get_picture(&#39;picture&#39;)
    shadow:   @_get_picture(&#39;shadow&#39;)
  _.extend @provider_options, base_options

create_infowindow_on_click: -&gt;
  @addListener &#39;click&#39;, @infowindow_binding

infowindow_binding: =&gt;
  @constructor.CURRENT_INFOWINDOW.close() if @_should_close_infowindow()
  @marker.panTo()
  @infowindow ?= @create_infowindow()

  return unless @infowindow?

  @infowindow.open( @getServiceObject().getMap(), @getServiceObject())
  @marker.infowindow ?= @infowindow
  @constructor.CURRENT_INFOWINDOW = @infowindow

_get_picture: (picture_name)-&gt;
  return null if !_.isObject(@args[picture_name]) || !_.isString(@args[picture_name].url)
  @_create_or_retrieve_image @_picture_args(picture_name)

_create_or_retrieve_image: (picture_args) -&gt;
  if @constructor.CACHE_STORE[picture_args.url] is undefined
    @constructor.CACHE_STORE[picture_args.url] = new(@primitives().markerImage)(picture_args.url, picture_args.size, picture_args.origin, picture_args.anchor , picture_args.scaledSize)

  @constructor.CACHE_STORE[picture_args.url]

_picture_args: (picture_name)-&gt;
  {
    url:        @args[picture_name].url
    anchor:     @_createImageAnchorPosition @args[picture_name].anchor
    size:       new(@primitives().size)(@args[picture_name].width, @args[picture_name].height)
    scaledSize: null
    origin:     null
  }

_createImageAnchorPosition : (anchorLocation) -&gt;
  return null unless _.isArray anchorLocation
  new(@primitives().point)(anchorLocation[0], anchorLocation[1])

_should_close_infowindow: -&gt;
  @internal_options.singleInfowindow and @constructor.CURRENT_INFOWINDOW?

_randomized_coordinates: -&gt;
  return [@args.lat, @args.lng] unless _.isNumber(@internal_options.maxRandomDistance)

  #gives a value between -1 and 1
  random = -&gt; (Math.random() * 2 - 1)
  dx  = @internal_options.maxRandomDistance * random()
  dy  = @internal_options.maxRandomDistance * random()
  Lat = parseFloat(@args.lat) + (180/Math.PI)*(dy/6378137)
  Lng = parseFloat(@args.lng) + ( 90/Math.PI)*(dx/6378137)/Math.cos(@args.lat)
  return [Lat, Lng]</pre>
</main>



<footer id="validator-badges" role="contentinfo">
  <p><a href="http://validator.w3.org/check/referer">Validate</a>
  <p>Generated by <a href="https://rdoc.github.io/rdoc">RDoc</a> 5.1.0.
  <p>Based on <a href="http://deveiate.org/projects/Darkfish-RDoc/">Darkfish</a> by <a href="http://deveiate.org">Michael Granger</a>.
</footer>

